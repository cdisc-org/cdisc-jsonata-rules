Authorities:
  - Organization: CDISC
    Standards:
      - Name: USDM
        References:
          - Citations:
              - Cited Guidance: 'A masking is expected to be defined for at least two study
                  roles in a study design with a double blind blinding schema.'
                Document: 'USDM_CORE_Rules.xlsx'
            Origin: 'USDM Conformance Rules'
            Rule Identifier:
              Id: 'DDF00192'
              Version: '1'
            Version: '1.0'
        Version: '4.0'
Check: |-
  ($.study.versions)@$sv.($sv.studyDesigns)@$sd[$sd.blindingSchema.standardCode.code = "C15228"].
      [
          ( 
              $maskedRoles :=$sv.roles@$r [$r.masking.isMasked and
                                              (
                                                  $sv.id in $r.appliesToIds or
                                                  $sd.id in $r.appliesToIds
                                              )
                                          ].  {
                                                  "id": $r.id,
                                                  "name": $r.name,
                                                  "code": $r.code.decode,
                                                  "Masking.text": $r.masking.text,
                                                  "Masking.isMasked": $r.masking.isMasked,
                                                  "appliesToIds": [$r.appliesToIds]
                                              };
              {
                  "id": $sd.id,
                  "name": $sd.name,
                  "blindingSchema": $sd.blindingSchema.standardCode.decode,
                  "dataset": $sd.instanceType,
                  "Masked Roles": $maskedRoles,
                  "Count of Masked Roles": $count($maskedRoles)
              }
          )                                     
              
      ][`Count of Masked Roles` < 2]
Core:
  Id: 'DDF00192'
  Status: Draft
  Version: '1'
Description: 'A masking is expected to be defined for at least two study roles
  in a study design with a double blind blinding schema.'
Executability: Partially Executable - Possible Overreporting
Outcome:
  Message: 'The study design has a double blind blinding schema but there are not
    at least two applicable study roles that are masked.'
  Output Variables:
    - id
    - name
    - blindingSchema
    - "Masked Roles"
    - "Count of Masked Roles"
Rule Type: JSONata
Scope:
  Entities:
    Include:
      - 'InterventionalStudyDesign'
Sensitivity: Record
