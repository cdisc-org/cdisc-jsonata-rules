[{"kind":1,"language":"markdown","value":"Import utility functions","outputs":[]},{"kind":2,"language":"jsonata","value":"$utils := $merge([$import(\"./utils/get_idmap.jsonata\")\r\n                 ,$import(\"./utils/get_maxids.jsonata\")\r\n                 ,$import(\"./utils/make_dup.jsonata\")\r\n                 ,$import(\"./utils/get_rule.jsonata\")\r\n                 ,$import(\"./utils/report.jsonata\")]) ","outputs":[]},{"kind":1,"language":"markdown","value":"Define test","outputs":[]},{"kind":2,"language":"jsonata","value":"$rule := $utils.get_rule($import(\"./rules/DDF00248/DDF00248.json\"))","outputs":[]},{"kind":1,"language":"markdown","value":"Create test data","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    /***********************************************************************\\\r\n    * Use the CDISC Pilot data as a start point                             *\r\n    \\***********************************************************************/\r\n\r\n    $old_study := $loadFile(\"./testdata/CDISC_Pilot_Study.json\");\r\n\r\n    /***********************************************************************\\\r\n    * Create and insert a second study design as a copy of the first        *\r\n    \\***********************************************************************/\r\n    $maxids := $utils.get_maxids($old_study);\r\n    $idmap := $utils.get_idmap($old_study.**.studyDesigns[0],$maxids);\r\n    $new_sd := $utils.make_dup($old_study.**.studyDesigns[0],$idmap) ~> |$|\r\n        {\r\n            \"name\": \"Study Design 2\",\r\n            \"eligibilityCriteria\": $append(eligibilityCriteria[category.code=\"C25532\"][[0..6]],eligibilityCriteria[category.code=\"C25370\"][[0..21]])\r\n        }|;\r\n    $new_study1 := $old_study ~> |study.versions[0]|{\"studyDesigns\": $append(studyDesigns,$new_sd)}|;\r\n\r\n    $writeFile(\"./rules/DDF00248/unit-test-coreid-DDF00248-positive-1.json\",$new_study1);\r\n    \r\n    /***********************************************************************\\\r\n    * Remove reference to:                                                  *\r\n    * - the first eligility criterion from the 1st study design's           *\r\n    *   population.                                                         *\r\n    * - the last eligibility criterion from both of the 2nd study design's  *\r\n    *   cohorts.                                                            *\r\n    \\***********************************************************************/\r\n    $first_id:=study.versions[0].studyDesigns[0].eligibilityCriteria[0].criterionItemId;\r\n    $last_id:=study.versions[0].studyDesigns[1].eligibilityCriteria[-1].criterionItemId;\r\n    $new_study2 := $new_study1\r\n                   ~> |study.versions[0].studyDesigns[0].eligibilityCriteria[1]|{\"criterionItemId\": $first_id}|;\r\n    $new_study2 := $new_study2               \r\n                   ~> |study.versions[0].studyDesigns[1].eligibilityCriteria[27]|{\"criterionItemId\": $last_id}|;\r\n    $writeFile(\"./rules/DDF00248/unit-test-coreid-DDF00248-negative-1.json\",$new_study2);\r\n)","outputs":[]},{"kind":1,"language":"markdown","value":"Test positive data","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    $pos_data := $loadFile(\"./rules/DDF00248/unit-test-coreid-DDF00248-positive-1.json\");\r\n    $utils.report($rule,$pos_data);\r\n)","outputs":[]},{"kind":1,"language":"markdown","value":"Test negative data","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    $neg_data := $loadFile(\"./rules/DDF00248/unit-test-coreid-DDF00248-negative-1.json\");\r\n    $utils.report($rule,$neg_data)\r\n\r\n)","outputs":[]}]