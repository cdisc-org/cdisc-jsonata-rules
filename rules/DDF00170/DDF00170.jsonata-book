[{"kind":1,"language":"markdown","value":"Import utility functions","outputs":[]},{"kind":2,"language":"jsonata","value":"$utils := $merge([$import(\"./utils/get_idmap.jsonata\")\r\n                 ,$import(\"./utils/get_maxids.jsonata\")\r\n                 ,$import(\"./utils/make_dup.jsonata\")\r\n                 ,$import(\"./utils/get_rule.jsonata\")\r\n                 ,$import(\"./utils/report.jsonata\")]) ","outputs":[]},{"kind":1,"language":"markdown","value":"Define test","outputs":[]},{"kind":2,"language":"jsonata","value":"$rule := $utils.get_rule($import(\"./rules/DDF00170/DDF00170.json\"))","outputs":[]},{"kind":1,"language":"markdown","value":"Create test data","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    /***********************************************************************\\\r\n    * Use the CDISC Pilot data as a start point and add abbreviations       *\r\n    \\***********************************************************************/\r\n\r\n    $old_study :=   $loadFile(\"./testdata/CDISC_Pilot_Study.json\") ~>\r\n                    |study.versions|{\"abbreviations\": [\r\n                                        {\r\n                                            \"id\": \"Abbreviation_1\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"AE\",\r\n                                            \"expandedText\": \"adverse event\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_2\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"BMI\",\r\n                                            \"expandedText\": \"body mass index\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_3\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"C-I\",\r\n                                            \"expandedText\": \"check-in\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_4\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"Cu\",\r\n                                            \"expandedText\": \"copper\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_5\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"D\",\r\n                                            \"expandedText\": \"day\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_6\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"ECG\",\r\n                                            \"expandedText\": \"electrocardiogram\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_7\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"EOS/ET\",\r\n                                            \"expandedText\": \"End of Study or Early Termination\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_8\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"HIV\",\r\n                                            \"expandedText\": \"human immunodeficiency virus\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_9\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"HR\",\r\n                                            \"expandedText\": \"heart rate\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_10\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"LBC\",\r\n                                            \"expandedText\": \"labile bound copper\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_11\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"Mo\",\r\n                                            \"expandedText\": \"molybdenum\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_12\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"OP\",\r\n                                            \"expandedText\": \"outpatient\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_13\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"PD\",\r\n                                            \"expandedText\": \"pharmacodynamic\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_14\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"PK\",\r\n                                            \"expandedText\": \"pharmacokinetics\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_15\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"PUF\",\r\n                                            \"expandedText\": \"plasma ultrafiltrate\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_16\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"PUFF\",\r\n                                            \"expandedText\": \"puffs\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_17\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"UNS\",\r\n                                            \"expandedText\": \"unscheduled\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_18\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"WD\",\r\n                                            \"expandedText\": \"Wilson disease\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        },\r\n                                        {\r\n                                            \"id\": \"Abbreviation_19\",\r\n                                            \"extensionAttributes\": [],\r\n                                            \"abbreviatedText\": \"Hr\",\r\n                                            \"expandedText\": \"hour\",\r\n                                            \"notes\": [],\r\n                                            \"instanceType\": \"Abbreviation\"\r\n                                        }]}|;\r\n\r\n    /***********************************************************************\\\r\n    * Write out as positive unit test data.                                 *\r\n    \\***********************************************************************/\r\n    $writeFile(\"./rules/DDF00170/unit-test-coreid-DDF00170-positive.json\",$old_study);\r\n    \r\n    /***********************************************************************\\\r\n    * Modify 2 abbreviatedText values to create duplicates and then write   *\r\n    * out as negative unit test data.                                       *\r\n    \\***********************************************************************/\r\n    $new_study1 :=  $old_study\r\n                    ~> |study.versions.abbreviations[abbreviatedText=\"PUFF\"]|{\"abbreviatedText\": \"PUF\"}|\r\n                    ~> |study.versions.abbreviations[abbreviatedText=\"Hr\"]|{\"abbreviatedText\": \"HR\"}|;\r\n    $writeFile(\"./rules/DDF00170/unit-test-coreid-DDF00170-negative.json\",$new_study1);\r\n)","outputs":[]},{"kind":1,"language":"markdown","value":"Test positive data","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    $pos_data := $loadFile(\"./rules/DDF00170/unit-test-coreid-DDF00170-positive.json\");\r\n    $utils.report($rule,$pos_data);\r\n)","outputs":[]},{"kind":1,"language":"markdown","value":"Test negative data","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    $neg_data := $loadFile(\"./rules/DDF00170/unit-test-coreid-DDF00170-negative.json\");\r\n    $utils.report($rule,$neg_data)\r\n)","outputs":[]}]