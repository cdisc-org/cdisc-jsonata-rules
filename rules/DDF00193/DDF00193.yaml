Authorities:
  - Organization: CDISC
    Standards:
      - Name: USDM
        References:
          - Citations:
              - Cited Guidance: 'A masking is expected to be defined for at least one study role
                  in a study design with a blinding schema that is not open
                  label or double blind.'
                Document: 'USDM_CORE_Rules.xlsx'
            Origin: 'USDM Conformance Rules'
            Rule Identifier:
              Id: 'DDF00193'
              Version: '1'
            Version: '1.0'
        Version: '4.0'
Check: |-
  ($.study.versions)@$sv.
  ($sv.studyDesigns)@$sd[ $sd.blindingSchema and
                          $not($sd.blindingSchema.standardCode.code in ["C49659","C15228"])].
      [
          ( $maskedRoles :=$sv.roles@$r[(
                                                      $sv.id in $r.appliesToIds or
                                                      $sd.id in $r.appliesToIds
                                                  )
                                              ].{
                                                  "id": $r.id,
                                                  "name": $r.name,
                                                  "code.decode": $r.code.decode,
                                                  "masking.isMasked": $r.masking.isMasked,
                                                  "appliesToIds": [$r.appliesToIds]
                                              };
          {
                          "id": $sd.id,
                          "name": $sd.name,
                          "blindingSchema": $sd.blindingSchema.standardCode.decode,
                          "dataset": $sd.instanceType,
                          "Applicable Roles": $maskedRoles,
                          "Count of Masked Roles": $count($maskedRoles[`masking.isMasked` = true])
          })                                     
              
      ][`Count of Masked Roles` < 1]
Core:
  Id: 'DDF00193'
  Status: Draft
  Version: '1'
Description: 'A masking is expected to be defined for at least one study role in
  a study design with a blinding schema that is not open label or double blind.'
Executability: Partially Executable - Possible Overreporting
Outcome:
  Message: 'The study design has a blinding schema that is not open label or
    double blind but there is no applicable study role that is masked.'
  Output Variables:
    - id
    - name
    - blindingSchema
    - "Applicable Roles"
    - "Count of Masked Roles"
Rule Type: JSONata
Scope:
  Entities:
    Include:
      - 'InterventionalStudyDesign'
Sensitivity: Record
