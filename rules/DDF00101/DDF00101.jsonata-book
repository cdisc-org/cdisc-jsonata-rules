[{"kind":1,"language":"markdown","value":"Import utility functions","outputs":[]},{"kind":2,"language":"jsonata","value":"$utils := $merge([$import(\"./utils/get_idmap.jsonata\")\r\n                 ,$import(\"./utils/get_maxids.jsonata\")\r\n                 ,$import(\"./utils/make_dup.jsonata\")\r\n                 ,$import(\"./utils/get_rule.jsonata\")\r\n                 ,$import(\"./utils/report.jsonata\")]) ","outputs":[]},{"kind":1,"language":"markdown","value":"Define test","outputs":[]},{"kind":2,"language":"jsonata","value":"$rule := $utils.get_rule($import(\"./rules/DDF00101/DDF00101.json\"))","outputs":[]},{"kind":1,"language":"markdown","value":"Create test data","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    /***********************************************************************\\\r\n    * Use the v4 CDISC Pilot data as a start point                             *\r\n    \\***********************************************************************/\r\n\r\n    $old_study1 :=   $loadFile(\"./testdata/CDISC_Pilot_Study.json\");\r\n\r\n    /***********************************************************************\\\r\n    * Create and insert a copy of the first study design as an              *\r\n    * observational study design.                                           *\r\n    \\***********************************************************************/\r\n    $maxids := $utils.get_maxids($old_study1);\r\n    $idmap := $utils.get_idmap($old_study1.study.versions[0].studyDesigns[0],$maxids);\r\n    $new_sd1 := $utils.make_dup($old_study1.study.versions[0].studyDesigns[0],$idmap)\r\n                ~> |$|{\r\n                        \"id\": \"ObservationalStudyDesign_1\",\r\n                        \"instanceType\": \"ObservationalStudyDesign\",\r\n                        \"name\": \"Study Design 2\",\r\n                        \"description\": \"An observational design for the study\",\r\n                        \"timePerspective\": (blindingSchema.standardCode ~> |$|{\"code\": \"C15273\",\"decode\": \"PROSPECTIVE\"}|)\r\n                      },[\"blindingSchema\",\"intentTypes\",\"subTypes\"]|\r\n                ~> |studyType|{\"code\": \"C16084\", \"decode\": \"OBSERVATIONAL\"}|\r\n                ~> |model|{\"code\": \"C15208\", \"decode\": \"COHORT\"}|;\r\n    $new_study1 := $old_study1\r\n                ~> |study.versions[0]|{\"studyDesigns\": $append(studyDesigns,$new_sd1)}|;\r\n\r\n    /***********************************************************************\\\r\n    * Write out as negative unit test data (refs to study interventions are *\r\n    * missing from the original example data). Only the first study design  *\r\n    * is expected to be reported.                                           *\r\n    \\***********************************************************************/\r\n    $writeFile(\"./rules/DDF00101/unit-test-coreid-DDF00101-negative-1.json\",$new_study1);\r\n    \r\n    /***********************************************************************\\\r\n    * Add the refs to study interventions to one of the activities and      *\r\n    * write out as positive unit test data.                                 *\r\n    \\***********************************************************************/\r\n    $si_ids := $new_study1.study.versions[0].studyInterventions.id[];\r\n\r\n    $maxids := $utils.get_maxids($new_study1);\r\n    $idmap := $utils.get_idmap($new_study1.study.versions[0].studyDesigns[0].activities[id=\"Activity_18\"].definedProcedures[0],$maxids);\r\n    $new_dp1 := $utils.make_dup($new_study1.study.versions[0].studyDesigns[0].activities[id=\"Activity_18\"].definedProcedures[0],$idmap)\r\n                ~> |$|  {\r\n                            \"name\": \"PR_DISP\",\r\n                            \"label\": \"Medications dispensed\",\r\n                            \"description\": \"Medications dispensed\",\r\n                            \"procedureType\": \"Disposition\",\r\n                            \"studyInterventionId\": $si_ids[0]\r\n                        }| \r\n                ~> |code|{\"code\": \"373784005\", \"decode\": \"Dispensing medication\"}|;\r\n    $new_study2 :=  $new_study1\r\n                    ~> |study.versions[0].studyDesigns[0].activities[id=\"Activity_25\"]|\r\n                        {\r\n                            \"definedProcedures\"[]: [$new_dp1]\r\n                        }|;\r\n                        \r\n    $maxids := $utils.get_maxids($new_study2);\r\n    $idmap := $utils.get_idmap($new_study2.study.versions[0].studyDesigns[0].activities[id=\"Activity_18\"].definedProcedures[0],$maxids);\r\n    $new_dp2 := $utils.make_dup($new_study2.study.versions[0].studyDesigns[0].activities[id=\"Activity_18\"].definedProcedures[0],$idmap)\r\n                ~> |$|  {\r\n                            \"name\": \"PR_RECON\",\r\n                            \"label\": \"Medications reconciliation\",\r\n                            \"description\": \"Medications reconciliation\",\r\n                            \"procedureType\": \"Disposition\",\r\n                            \"studyInterventionId\": $si_ids[0]\r\n                        }| \r\n                ~> |code|{\"code\": \"430193006\", \"decode\": \"Medication reconciliation\"}|;\r\n    $new_study3 :=  $new_study2\r\n                    ~> |study.versions[0].studyDesigns[0].activities[id=\"Activity_25\"]|\r\n                        {\r\n                            \"definedProcedures\"[]: $append(definedProcedures,$new_dp2)\r\n                        }|;\r\n                        \r\n    $writeFile(\"./rules/DDF00101/unit-test-coreid-DDF00101-positive-1.json\",$new_study3);\r\n\r\n    /***********************************************************************\\\r\n    * Use the v3 CDISC Pilot data as a start point                             *\r\n    \\***********************************************************************/\r\n\r\n    $old_study2 :=  $loadFile(\"./testdata/CDISC_Pilot_Study_v3.json\")\r\n                    ~> |study.versions[0].studyDesigns[0]|{\r\n                        \"studyInterventions\": [\r\n                            {\r\n                                \"id\": \"StudyIntervention_1\",\r\n                                \"name\": \"SI_XAN_LO\",\r\n                                \"label\": \"Xanomeline Low Dose\",\r\n                                \"description\": \"Xanomeline Low Dose\",\r\n                                \"role\": {\r\n                                \"id\": \"Code_600\",\r\n                                \"code\": \"C41161\",\r\n                                \"codeSystem\": \"http://www.cdisc.org\",\r\n                                \"codeSystemVersion\": \"2024-09-27\",\r\n                                \"decode\": \"Experimental Intervention\",\r\n                                \"instanceType\": \"Code\"\r\n                                },\r\n                                \"type\": {\r\n                                \"id\": \"Code_601\",\r\n                                \"code\": \"C1909\",\r\n                                \"codeSystem\": \"http://www.cdisc.org\",\r\n                                \"codeSystemVersion\": \"2024-09-27\",\r\n                                \"decode\": \"DRUG\",\r\n                                \"instanceType\": \"Code\"\r\n                                },\r\n                                \"minimumResponseDuration\": {\r\n                                \"id\": \"Quantity_2\",\r\n                                \"value\": 1,\r\n                                \"unit\": {\r\n                                    \"id\": \"AliasCode_203\",\r\n                                    \"standardCode\": {\r\n                                    \"id\": \"Code_602\",\r\n                                    \"code\": \"C25301\",\r\n                                    \"codeSystem\": \"http://www.cdisc.org\",\r\n                                    \"codeSystemVersion\": \"2024-09-27\",\r\n                                    \"decode\": \"Day\",\r\n                                    \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                },\r\n                                \"instanceType\": \"Quantity\"\r\n                                },\r\n                                \"codes\": [\r\n                                {\r\n                                    \"id\": \"Code_603\",\r\n                                    \"code\": \"XAN\",\r\n                                    \"codeSystem\": \"SPONSOR\",\r\n                                    \"codeSystemVersion\": \"12\",\r\n                                    \"decode\": \"XAN\",\r\n                                    \"instanceType\": \"Code\"\r\n                                }\r\n                                ],\r\n                                \"administrations\": [\r\n                                {\r\n                                    \"id\": \"AgentAdministration_1\",\r\n                                    \"name\": \"ADM_XL_P50_A\",\r\n                                    \"label\": \"50 cm2 Patch\",\r\n                                    \"description\": \"50 cm2 Patch (Active)\",\r\n                                    \"duration\": {\r\n                                    \"id\": \"AdministrationDuration_1\",\r\n                                    \"text\": \"\",\r\n                                    \"quantity\": {\r\n                                        \"id\": \"Quantity_3\",\r\n                                        \"value\": 24,\r\n                                        \"unit\": {\r\n                                        \"id\": \"AliasCode_204\",\r\n                                        \"standardCode\": {\r\n                                            \"id\": \"Code_604\",\r\n                                            \"code\": \"C29844\",\r\n                                            \"codeSystem\": \"http://www.cdisc.org\",\r\n                                            \"codeSystemVersion\": \"2024-09-27\",\r\n                                            \"decode\": \"Week\",\r\n                                            \"instanceType\": \"Code\"\r\n                                        },\r\n                                        \"standardCodeAliases\": [],\r\n                                        \"instanceType\": \"AliasCode\"\r\n                                        },\r\n                                        \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"durationWillVary\": false,\r\n                                    \"reasonDurationWillVary\": \"\",\r\n                                    \"instanceType\": \"AdministrationDuration\",\r\n                                    \"description\": \"\"\r\n                                    },\r\n                                    \"frequency\": {\r\n                                    \"id\": \"AliasCode_205\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_605\",\r\n                                        \"code\": \"C25473\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"Daily\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    },\r\n                                    \"instanceType\": \"AgentAdministration\",\r\n                                    \"dose\": {\r\n                                    \"id\": \"Quantity_4\",\r\n                                    \"value\": 54,\r\n                                    \"unit\": {\r\n                                        \"id\": \"AliasCode_206\",\r\n                                        \"standardCode\": {\r\n                                        \"id\": \"Code_606\",\r\n                                        \"code\": \"C28253\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"mg\",\r\n                                        \"instanceType\": \"Code\"\r\n                                        },\r\n                                        \"instanceType\": \"AliasCode\"\r\n                                    },\r\n                                    \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"route\": {\r\n                                    \"id\": \"AliasCode_207\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_607\",\r\n                                        \"code\": \"C38305\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"TRANSDERMAL\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    }\r\n                                },\r\n                                {\r\n                                    \"id\": \"AgentAdministration_2\",\r\n                                    \"name\": \"ADM_XL_P25_P\",\r\n                                    \"label\": \"25 cm2 Patch\",\r\n                                    \"description\": \"25 cm2 Patch (Placebo)\",\r\n                                    \"duration\": {\r\n                                    \"id\": \"AdministrationDuration_2\",\r\n                                    \"text\": \"\",\r\n                                    \"quantity\": {\r\n                                        \"id\": \"Quantity_5\",\r\n                                        \"value\": 24,\r\n                                        \"unit\": {\r\n                                        \"id\": \"AliasCode_208\",\r\n                                        \"standardCode\": {\r\n                                            \"id\": \"Code_608\",\r\n                                            \"code\": \"C29844\",\r\n                                            \"codeSystem\": \"http://www.cdisc.org\",\r\n                                            \"codeSystemVersion\": \"2024-09-27\",\r\n                                            \"decode\": \"Week\",\r\n                                            \"instanceType\": \"Code\"\r\n                                        },\r\n                                        \"standardCodeAliases\": [],\r\n                                        \"instanceType\": \"AliasCode\"\r\n                                        },\r\n                                        \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"durationWillVary\": false,\r\n                                    \"reasonDurationWillVary\": \"\",\r\n                                    \"instanceType\": \"AdministrationDuration\",\r\n                                    \"description\": \"\"\r\n                                    },\r\n                                    \"frequency\": {\r\n                                    \"id\": \"AliasCode_209\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_609\",\r\n                                        \"code\": \"C25473\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"Daily\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    },\r\n                                    \"instanceType\": \"AgentAdministration\",\r\n                                    \"dose\": {\r\n                                    \"id\": \"Quantity_6\",\r\n                                    \"value\": 0,\r\n                                    \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"route\": {\r\n                                    \"id\": \"AliasCode_210\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_610\",\r\n                                        \"code\": \"C38305\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"TRANSDERMAL\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    }\r\n                                }\r\n                                ],\r\n                                \"instanceType\": \"StudyIntervention\",\r\n                                \"productDesignation\": {\r\n                                \"id\": \"Code_611\",\r\n                                \"code\": \"C202579\",\r\n                                \"codeSystem\": \"http://www.cdisc.org\",\r\n                                \"codeSystemVersion\": \"2024-09-27\",\r\n                                \"decode\": \"IMP\",\r\n                                \"instanceType\": \"Code\"\r\n                                }\r\n                            },\r\n                            {\r\n                                \"id\": \"StudyIntervention_2\",\r\n                                \"name\": \"SI_XAN_HI\",\r\n                                \"label\": \"Xanomeline High Dose\",\r\n                                \"description\": \"Xanomeline High Dose\",\r\n                                \"role\": {\r\n                                \"id\": \"Code_612\",\r\n                                \"code\": \"C41161\",\r\n                                \"codeSystem\": \"http://www.cdisc.org\",\r\n                                \"codeSystemVersion\": \"2024-09-27\",\r\n                                \"decode\": \"Experimental Intervention\",\r\n                                \"instanceType\": \"Code\"\r\n                                },\r\n                                \"type\": {\r\n                                \"id\": \"Code_613\",\r\n                                \"code\": \"C1909\",\r\n                                \"codeSystem\": \"http://www.cdisc.org\",\r\n                                \"codeSystemVersion\": \"2024-09-27\",\r\n                                \"decode\": \"DRUG\",\r\n                                \"instanceType\": \"Code\"\r\n                                },\r\n                                \"minimumResponseDuration\": {\r\n                                \"id\": \"Quantity_7\",\r\n                                \"value\": 1,\r\n                                \"unit\": {\r\n                                    \"id\": \"AliasCode_211\",\r\n                                    \"standardCode\": {\r\n                                    \"id\": \"Code_614\",\r\n                                    \"code\": \"C25301\",\r\n                                    \"codeSystem\": \"http://www.cdisc.org\",\r\n                                    \"codeSystemVersion\": \"2024-09-27\",\r\n                                    \"decode\": \"Day\",\r\n                                    \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                },\r\n                                \"instanceType\": \"Quantity\"\r\n                                },\r\n                                \"codes\": [\r\n                                {\r\n                                    \"id\": \"Code_615\",\r\n                                    \"code\": \"XAN\",\r\n                                    \"codeSystem\": \"SPONSOR\",\r\n                                    \"codeSystemVersion\": \"12\",\r\n                                    \"decode\": \"XAN\",\r\n                                    \"instanceType\": \"Code\"\r\n                                }\r\n                                ],\r\n                                \"administrations\": [\r\n                                {\r\n                                    \"id\": \"AgentAdministration_3\",\r\n                                    \"name\": \"ADM_XH_P50_A\",\r\n                                    \"label\": \"50 cm2 Patch\",\r\n                                    \"description\": \"50 cm2 Patch (Active)\",\r\n                                    \"duration\": {\r\n                                    \"id\": \"AdministrationDuration_3\",\r\n                                    \"text\": \"\",\r\n                                    \"quantity\": {\r\n                                        \"id\": \"Quantity_8\",\r\n                                        \"value\": 24,\r\n                                        \"unit\": {\r\n                                        \"id\": \"AliasCode_212\",\r\n                                        \"standardCode\": {\r\n                                            \"id\": \"Code_616\",\r\n                                            \"code\": \"C29844\",\r\n                                            \"codeSystem\": \"http://www.cdisc.org\",\r\n                                            \"codeSystemVersion\": \"2024-09-27\",\r\n                                            \"decode\": \"Week\",\r\n                                            \"instanceType\": \"Code\"\r\n                                        },\r\n                                        \"standardCodeAliases\": [],\r\n                                        \"instanceType\": \"AliasCode\"\r\n                                        },\r\n                                        \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"durationWillVary\": false,\r\n                                    \"reasonDurationWillVary\": \"\",\r\n                                    \"instanceType\": \"AdministrationDuration\",\r\n                                    \"description\": \"\"\r\n                                    },\r\n                                    \"frequency\": {\r\n                                    \"id\": \"AliasCode_213\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_617\",\r\n                                        \"code\": \"C25473\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"Daily\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    },\r\n                                    \"instanceType\": \"AgentAdministration\",\r\n                                    \"dose\": {\r\n                                    \"id\": \"Quantity_9\",\r\n                                    \"value\": 54,\r\n                                    \"unit\": {\r\n                                        \"id\": \"AliasCode_214\",\r\n                                        \"standardCode\": {\r\n                                        \"id\": \"Code_618\",\r\n                                        \"code\": \"C28253\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"mg\",\r\n                                        \"instanceType\": \"Code\"\r\n                                        },\r\n                                        \"instanceType\": \"AliasCode\"\r\n                                    },\r\n                                    \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"route\": {\r\n                                    \"id\": \"AliasCode_215\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_619\",\r\n                                        \"code\": \"C38305\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"TRANSDERMAL\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    }\r\n                                },\r\n                                {\r\n                                    \"id\": \"AgentAdministration_4\",\r\n                                    \"name\": \"ADM_XH_P25_A\",\r\n                                    \"label\": \"25 cm2 Patch\",\r\n                                    \"description\": \"25 cm2 Patch (Active)\",\r\n                                    \"duration\": {\r\n                                    \"id\": \"AdministrationDuration_4\",\r\n                                    \"text\": \"\",\r\n                                    \"quantity\": {\r\n                                        \"id\": \"Quantity_10\",\r\n                                        \"value\": 24,\r\n                                        \"unit\": {\r\n                                        \"id\": \"AliasCode_216\",\r\n                                        \"standardCode\": {\r\n                                            \"id\": \"Code_620\",\r\n                                            \"code\": \"C29844\",\r\n                                            \"codeSystem\": \"http://www.cdisc.org\",\r\n                                            \"codeSystemVersion\": \"2024-09-27\",\r\n                                            \"decode\": \"Week\",\r\n                                            \"instanceType\": \"Code\"\r\n                                        },\r\n                                        \"standardCodeAliases\": [],\r\n                                        \"instanceType\": \"AliasCode\"\r\n                                        },\r\n                                        \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"durationWillVary\": false,\r\n                                    \"reasonDurationWillVary\": \"\",\r\n                                    \"instanceType\": \"AdministrationDuration\",\r\n                                    \"description\": \"\"\r\n                                    },\r\n                                    \"frequency\": {\r\n                                    \"id\": \"AliasCode_217\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_621\",\r\n                                        \"code\": \"C25473\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"Daily\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    },\r\n                                    \"instanceType\": \"AgentAdministration\",\r\n                                    \"dose\": {\r\n                                    \"id\": \"Quantity_11\",\r\n                                    \"value\": 27,\r\n                                    \"unit\": {\r\n                                        \"id\": \"AliasCode_218\",\r\n                                        \"standardCode\": {\r\n                                        \"id\": \"Code_622\",\r\n                                        \"code\": \"C28253\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"mg\",\r\n                                        \"instanceType\": \"Code\"\r\n                                        },\r\n                                        \"instanceType\": \"AliasCode\"\r\n                                    },\r\n                                    \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"route\": {\r\n                                    \"id\": \"AliasCode_219\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_623\",\r\n                                        \"code\": \"C38305\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"TRANSDERMAL\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    }\r\n                                }\r\n                                ],\r\n                                \"instanceType\": \"StudyIntervention\",\r\n                                \"productDesignation\": {\r\n                                \"id\": \"Code_624\",\r\n                                \"code\": \"C202579\",\r\n                                \"codeSystem\": \"http://www.cdisc.org\",\r\n                                \"codeSystemVersion\": \"2024-09-27\",\r\n                                \"decode\": \"IMP\",\r\n                                \"instanceType\": \"Code\"\r\n                                }\r\n                            },\r\n                            {\r\n                                \"id\": \"StudyIntervention_3\",\r\n                                \"name\": \"SI_PLAC\",\r\n                                \"label\": \"Placebo\",\r\n                                \"description\": \"Placebo\",\r\n                                \"role\": {\r\n                                \"id\": \"Code_625\",\r\n                                \"code\": \"C753\",\r\n                                \"codeSystem\": \"http://www.cdisc.org\",\r\n                                \"codeSystemVersion\": \"2024-09-27\",\r\n                                \"decode\": \"Placebo\",\r\n                                \"instanceType\": \"Code\"\r\n                                },\r\n                                \"type\": {\r\n                                \"id\": \"Code_626\",\r\n                                \"code\": \"C1909\",\r\n                                \"codeSystem\": \"http://www.cdisc.org\",\r\n                                \"codeSystemVersion\": \"2024-09-27\",\r\n                                \"decode\": \"DRUG\",\r\n                                \"instanceType\": \"Code\"\r\n                                },\r\n                                \"codes\": [\r\n                                {\r\n                                    \"id\": \"Code_627\",\r\n                                    \"code\": \"PBO\",\r\n                                    \"codeSystem\": \"SPONSOR\",\r\n                                    \"codeSystemVersion\": \"12\",\r\n                                    \"decode\": \"PBO\",\r\n                                    \"instanceType\": \"Code\"\r\n                                }\r\n                                ],\r\n                                \"administrations\": [\r\n                                {\r\n                                    \"id\": \"AgentAdministration_5\",\r\n                                    \"name\": \"ADM_P_P50_P\",\r\n                                    \"label\": \"50 cm2 Patch\",\r\n                                    \"description\": \"50 cm2 Patch (Placebo)\",\r\n                                    \"duration\": {\r\n                                    \"id\": \"AdministrationDuration_5\",\r\n                                    \"text\": \"\",\r\n                                    \"quantity\": {\r\n                                        \"id\": \"Quantity_12\",\r\n                                        \"value\": 24,\r\n                                        \"unit\": {\r\n                                        \"id\": \"AliasCode_220\",\r\n                                        \"standardCode\": {\r\n                                            \"id\": \"Code_628\",\r\n                                            \"code\": \"C29844\",\r\n                                            \"codeSystem\": \"http://www.cdisc.org\",\r\n                                            \"codeSystemVersion\": \"2024-09-27\",\r\n                                            \"decode\": \"Week\",\r\n                                            \"instanceType\": \"Code\"\r\n                                        },\r\n                                        \"standardCodeAliases\": [],\r\n                                        \"instanceType\": \"AliasCode\"\r\n                                        },\r\n                                        \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"durationWillVary\": false,\r\n                                    \"reasonDurationWillVary\": \"\",\r\n                                    \"instanceType\": \"AdministrationDuration\",\r\n                                    \"description\": \"\"\r\n                                    },\r\n                                    \"frequency\": {\r\n                                    \"id\": \"AliasCode_221\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_629\",\r\n                                        \"code\": \"C25473\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"Daily\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    },\r\n                                    \"instanceType\": \"AgentAdministration\",\r\n                                    \"dose\": {\r\n                                    \"id\": \"Quantity_13\",\r\n                                    \"value\": 0,\r\n                                    \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"route\": {\r\n                                    \"id\": \"AliasCode_222\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_630\",\r\n                                        \"code\": \"C38305\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"TRANSDERMAL\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    }\r\n                                },\r\n                                {\r\n                                    \"id\": \"AgentAdministration_6\",\r\n                                    \"name\": \"ADM_P_P25_P\",\r\n                                    \"label\": \"25 cm2 Patch\",\r\n                                    \"description\": \"25 cm2 Patch (Placebo)\",\r\n                                    \"duration\": {\r\n                                    \"id\": \"AdministrationDuration_6\",\r\n                                    \"text\": \"\",\r\n                                    \"quantity\": {\r\n                                        \"id\": \"Quantity_14\",\r\n                                        \"value\": 24,\r\n                                        \"unit\": {\r\n                                        \"id\": \"AliasCode_223\",\r\n                                        \"standardCode\": {\r\n                                            \"id\": \"Code_631\",\r\n                                            \"code\": \"C29844\",\r\n                                            \"codeSystem\": \"http://www.cdisc.org\",\r\n                                            \"codeSystemVersion\": \"2024-09-27\",\r\n                                            \"decode\": \"Week\",\r\n                                            \"instanceType\": \"Code\"\r\n                                        },\r\n                                        \"standardCodeAliases\": [],\r\n                                        \"instanceType\": \"AliasCode\"\r\n                                        },\r\n                                        \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"durationWillVary\": false,\r\n                                    \"reasonDurationWillVary\": \"\",\r\n                                    \"instanceType\": \"AdministrationDuration\",\r\n                                    \"description\": \"\"\r\n                                    },\r\n                                    \"frequency\": {\r\n                                    \"id\": \"AliasCode_224\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_632\",\r\n                                        \"code\": \"C25473\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"Daily\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    },\r\n                                    \"instanceType\": \"AgentAdministration\",\r\n                                    \"dose\": {\r\n                                    \"id\": \"Quantity_15\",\r\n                                    \"value\": 0,\r\n                                    \"instanceType\": \"Quantity\"\r\n                                    },\r\n                                    \"route\": {\r\n                                    \"id\": \"AliasCode_225\",\r\n                                    \"standardCode\": {\r\n                                        \"id\": \"Code_633\",\r\n                                        \"code\": \"C38305\",\r\n                                        \"codeSystem\": \"http://www.cdisc.org\",\r\n                                        \"codeSystemVersion\": \"2024-09-27\",\r\n                                        \"decode\": \"TRANSDERMAL\",\r\n                                        \"instanceType\": \"Code\"\r\n                                    },\r\n                                    \"standardCodeAliases\": [],\r\n                                    \"instanceType\": \"AliasCode\"\r\n                                    }\r\n                                }\r\n                                ],\r\n                                \"instanceType\": \"StudyIntervention\",\r\n                                \"productDesignation\": {\r\n                                \"id\": \"Code_634\",\r\n                                \"code\": \"C202579\",\r\n                                \"codeSystem\": \"http://www.cdisc.org\",\r\n                                \"codeSystemVersion\": \"2024-09-27\",\r\n                                \"decode\": \"IMP\",\r\n                                \"instanceType\": \"Code\"\r\n                                }\r\n                            }\r\n                            ]}|;\r\n\r\n    /***********************************************************************\\\r\n    * Write out as negative unit test data (refs to study interventions are *\r\n    * missing from the original example data). Only the first study design  *\r\n    * is expected to be reported.                                           *\r\n    \\***********************************************************************/\r\n    $writeFile(\"./rules/DDF00101/unit-test-coreid-DDF00101-negative-2.json\",$old_study2);\r\n\r\n    /***********************************************************************\\\r\n    * Add the refs to study interventions to one of the activities and      *\r\n    * write out as positive unit test data.                                 *\r\n    \\***********************************************************************/\r\n    $si_ids := $old_study2.study.versions[0].studyDesigns[0].studyInterventions.id[];\r\n\r\n    $maxids := $utils.get_maxids($old_study2);\r\n    $idmap := $utils.get_idmap($old_study2.study.versions[0].studyDesigns[0].activities[id=\"Activity_18\"].definedProcedures[0],$maxids);\r\n    $new_dp1 := $utils.make_dup($old_study2.study.versions[0].studyDesigns[0].activities[id=\"Activity_18\"].definedProcedures[0],$idmap)\r\n                ~> |$|  {\r\n                            \"name\": \"PR_DISP\",\r\n                            \"label\": \"Medications dispensed\",\r\n                            \"description\": \"Medications dispensed\",\r\n                            \"procedureType\": \"Disposition\",\r\n                            \"studyInterventionId\": $si_ids[0]\r\n                        }| \r\n                ~> |code|{\"code\": \"373784005\", \"decode\": \"Dispensing medication\"}|;\r\n    $new_study4 :=  $old_study2\r\n                    ~> |study.versions[0].studyDesigns[0].activities[id=\"Activity_25\"]|\r\n                        {\r\n                            \"definedProcedures\"[]: [$new_dp1]\r\n                        }|;\r\n                        \r\n    $maxids := $utils.get_maxids($new_study4);\r\n    $idmap := $utils.get_idmap($new_study4.study.versions[0].studyDesigns[0].activities[id=\"Activity_18\"].definedProcedures[0],$maxids);\r\n    $new_dp2 := $utils.make_dup($new_study4.study.versions[0].studyDesigns[0].activities[id=\"Activity_18\"].definedProcedures[0],$idmap)\r\n                ~> |$|  {\r\n                            \"name\": \"PR_RECON\",\r\n                            \"label\": \"Medications reconciliation\",\r\n                            \"description\": \"Medications reconciliation\",\r\n                            \"procedureType\": \"Disposition\",\r\n                            \"studyInterventionId\": $si_ids[0]\r\n                        }| \r\n                ~> |code|{\"code\": \"430193006\", \"decode\": \"Medication reconciliation\"}|;\r\n    $new_study4 :=  $new_study4\r\n                    ~> |study.versions[0].studyDesigns[0].activities[id=\"Activity_25\"]|\r\n                        {\r\n                            \"definedProcedures\"[]: $append(definedProcedures,$new_dp2)\r\n                        }|;\r\n                        \r\n    $writeFile(\"./rules/DDF00101/unit-test-coreid-DDF00101-positive-2.json\",$new_study4);\r\n\r\n)","outputs":[]},{"kind":1,"language":"markdown","value":"Test positive data - v4","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    $pos_data := $loadFile(\"./rules/DDF00101/unit-test-coreid-DDF00101-positive-1.json\");\r\n    $utils.report($rule,$pos_data);\r\n)","outputs":[]},{"kind":1,"language":"markdown","value":"Test negative data - v4","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    $neg_data := $loadFile(\"./rules/DDF00101/unit-test-coreid-DDF00101-negative-1.json\");\r\n    $utils.report($rule,$neg_data)\r\n)","outputs":[]},{"kind":1,"language":"markdown","value":"Test positive data - v3","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    $pos_data := $loadFile(\"./rules/DDF00101/unit-test-coreid-DDF00101-positive-2.json\");\r\n    $utils.report($rule,$pos_data);\r\n)","outputs":[]},{"kind":1,"language":"markdown","value":"Test negative data - v3","outputs":[]},{"kind":2,"language":"jsonata","value":"(\r\n    $neg_data := $loadFile(\"./rules/DDF00101/unit-test-coreid-DDF00101-negative-2.json\");\r\n    $utils.report($rule,$neg_data)\r\n)","outputs":[]}]