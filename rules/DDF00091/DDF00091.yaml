Authorities:
  - Organization: CDISC
    Standards:
      - Name: USDM
        References:
          - Citations:
              - Cited Guidance: 'When a condition applies to a procedure, activity, biomedical
                  concept, biomedical concept category, or biomedical concept
                  surrogate then an instance must be available in the
                  corresponding class with the specified id.'
                Document: 'USDM_CORE_Rules.xlsx'
            Origin: 'USDM Conformance Rules'
            Rule Identifier:
              Id: 'DDF00091'
              Version: '1'
            Version: '1.0'
        Version: '3.0'
      - Name: USDM
        References:
          - Citations:
              - Cited Guidance: 'When a condition applies to a procedure, activity, biomedical
                  concept, biomedical concept category, or biomedical concept
                  surrogate then an instance must be available in the
                  corresponding class with the specified id.'
                Document: 'USDM_CORE_Rules.xlsx'
            Origin: 'USDM Conformance Rules'
            Rule Identifier:
              Id: 'DDF00091'
              Version: '1'
            Version: '1.0'
        Version: '4.0'
Check: |-
  (
    $idityp:=$.study.versions.**[id]{id:instanceType};
    $.study.versions.**.conditions.appliesToIds.
      {
        "instanceType": %.instanceType,
        "id": %.id,
        "path": %._path,
        "name": %.name,
        "appliesTo id": $,
        "appliesTo instanceType": $ in $keys($idityp) ? $lookup($idityp,$) : "[Invalid id]"
      }
      [
        $not(`appliesTo instanceType` in
          [
            'Procedure',
            'Activity',
            'BiomedicalConcept',
            'BiomedicalConceptCategory',
            'BiomedicalConceptSurrogate'
          ]
        )
      ]
  )
Core:
  Id: 'DDF00091'
  Status: Draft
  Version: '1'
Description: 'When a condition applies to a procedure, activity, biomedical
  concept, biomedical concept category, or biomedical concept surrogate then an
  instance must be available in the corresponding class with the specified id.'
Executability: Fully Executable
Outcome:
  Message: 'The id value specified to indicate what the condition applies to does
    not reference a procedure, activity, biomedical concept, biomedical concept
    category, or biomedical concept surrogate - either the specified id is not
    an id for anything (it is invalid), or the instance identified by the id is
    not one of the expected classes.'
  Output Variables:
    - name
    - 'appliesTo id'
    - 'appliesTo instanceType'
Rule Type: JSONata
Scope:
  Entities:
    Include:
      - 'Condition'
Sensitivity: Record
