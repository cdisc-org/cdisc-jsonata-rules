Authorities:
  - Organization: CDISC
    Standards:
      - Name: USDM
        References:
          - Citations:
              - Cited Guidance: 'When a condition applies to a procedure, activity, biomedical
                  concept, biomedical concept category, or biomedical concept
                  surrogate then an instance must be available in the
                  corresponding class with the specified id.'
                Document: 'USDM_CORE_Rules.xlsx'
            Origin: 'USDM Conformance Rules'
            Rule Identifier:
              Id: 'DDF00091'
              Version: '1'
            Version: '1.0'
        Version: '3.0'
      - Name: USDM
        References:
          - Citations:
              - Cited Guidance: 'When a condition applies to a procedure, activity, biomedical
                  concept, biomedical concept category, or biomedical concept
                  surrogate then an instance must be available in the
                  corresponding class with the specified id.'
                Document: 'USDM_CORE_Rules.xlsx'
            Origin: 'USDM Conformance Rules'
            Rule Identifier:
              Id: 'DDF00091'
              Version: '1'
            Version: '1.0'
        Version: '4.0'
Check: |-
  (
      $idityp:=$.study.versions.**[id]{id:instanceType};
      $.study.versions.**.conditions.appliesToIds.
          {
              "parent_entity": %.%.instanceType,
              "parent_id": %.%.id,
              "id": %.id,
              "name": %.name,
              "appliesTo id": $,
              "appliesTo instanceType": $ in $keys($idityp) ? $lookup($idityp,$) : "[Invalid id]",
              "dataset": %.instanceType
          }
          [
              $not(`appliesTo instanceType` in
                  [
                      'Procedure',
                      'Activity',
                      'BiomedicalConcept',
                      'BiomedicalConceptCategory',
                      'BiomedicalConceptSurrogate'
                  ]
              )
          ]
  )
Core:
  Id: 'DDF00091'
  Status: Draft
  Version: '1'
Description: 'When a condition applies to a procedure, activity, biomedical
  concept, biomedical concept category, or biomedical concept surrogate then an
  instance must be available in the corresponding class with the specified id.'
Executability: Fully Executable
Outcome:
  Message: 'An invalid id value has been specified to indicate what the condition
    applies to - either the specified id is not an id for anything, or the
    instance identified by the id is not a procedure, activity, biomedical
    concept, biomedical concept category, or biomedical concept surrogate.'
  Output Variables:
    - parent_entity
    - parent_id
    - id
    - name
    - 'appliesTo id'
    - 'appliesTo instanceType'
Rule Type: JSONata
Scope:
  Entities:
    Include:
      - 'Condition'
Sensitivity: Record
